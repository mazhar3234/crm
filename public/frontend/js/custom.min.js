$(".select2").select2();


// $("#add_more").on("click", function(){
// 	// alert()
//     $("#duplicateDiv").clone(true).appendTo(".copyDiv");
//     $(".copyDiv").find("#duplicateDiv").css({"display": "flex"});
// });

// $(".rem").on("click", function(){ 
//     $(this).closest("#duplicateDiv").remove();
// });


var baseUrl = location.protocol + "//" + location.host + "/";
/*
* load modal for add resource 
**************************************************
*/
$("#add_location").on("click", function(){
    var locationId = $('.to-location:last').val();
    $.ajax({
        url  : baseUrl + "add-location/" + locationId,
        type : "GET",
        success: function(response) {
            $(".copyDiv").before(response);
        },
        error: function() {
            alert("There was might be some problem. Try again...");
        }
    });
});

var totalDistance = 0;
var totalDuration = 0;

function removeIt(ele) {
	$(ele).closest("#duplicateDiv").remove();
	loadCars(ele);
	// loadCars();
}

function loadCars(ele, sortBy = null) {
	if($("#from_location").val().length == 0 || $("#to_location").val().length == 0) {
		return;
	}
	totalDistance = 0;
	totalDuration = 0;

	var i=0;
	var fromLocations = [];
	$("#bookingForm .from-location").each(function() {
	    fromLocations[i++] = $(this).val();
	});

	console.log(fromLocations);

	var j = 0;
	var toLocations = [];
	$("#bookingForm .to-location").each(function() {
	    toLocations[j++] = $(this).val();
	});

		// alert(toLocations);
	for (var k = 0; k < j; k++) {
		getDistance(fromLocations[k], toLocations[k]);
	}
	setTimeout(function() {
		showTripInfo(totalDistance, totalDuration);

		$.ajax({
	        url  : baseUrl + "load-cars/" + totalDistance + "/" + sortBy,
	        type : "GET",
	        success: function(response) {
	            $("#carOutput").html(response);
	        },
	        error: function() {
	            alert("There was might be some problem. Try again...");
	        }
	    });
	}, 1500);
}

function getDistance(fromLocations, toLocations)
{
	$.ajax({
        url  : baseUrl + "get-distance/" + fromLocations + "/" + toLocations,
        type : "GET",
        success: function(response) {
        	var response = JSON.parse(response);
        	if(response.status == 'OK') {
        		var dis = response.rows[0]['elements'][0].distance.value;
        		var dur = response.rows[0]['elements'][0].duration.value;
            	
            	setValue(dis, dur);
        	}
        },
        error: function() {
            alert("There was might be some problem. Try again...");
        }
    });
}

function setValue(distance, duration)
{
	totalDistance = parseInt(totalDistance) + parseInt(distance);
	totalDuration = parseInt(totalDuration) + parseInt(duration);
}

function showTripInfo(distance, duration)
{
	var km = Math.round(distance/1000).toFixed();
	var totalMinute = (duration / 60);
	var hour = (totalMinute / 60).toFixed();
	var minute = (totalMinute % 60).toFixed();

	var info = km + " km, Trip duration: ";
	info += (hour) ? hour +" Hours " : "";
	info += (minute) ? minute +" Minute" : "";

	$("#duration").val(hour + " hour " + minute + " minute");
	$("#tripInfo").text(info);
}

function setVehicleInfo(vehicleId)
{
	if($("#datepicker").val().length == 0) {
		// $('#exampleModalCenter').on('show.bs.modal', function (e) {
		//   return e.preventDefault(); 
		// });
		$(".hasDatepicker").focus();
		return false;
	}

	$.ajax({
        url  : baseUrl + "set-vehicle/" + vehicleId,
        type : "GET",
        success: function(response) {
        	
        },
        error: function() {
            alert("There was might be some problem. Try again...");
        }
    });
}

function storeData(event)
{
	event.preventDefault();

	var first_name = $("#first_name").val();
	var last_name = $("#last_name").val();
	var mobile_no = $("#mobile_no").val();
	var email = $("#email").val();
	var pickup_address = $("#pickup_address").val();
	var time = $("#hour").val() + ":" + $("#minute").val();
	var date = $("#datepicker").val();
	var dropof_address = $("#dropof_address").val();
	var comment = $("#comment").val();
	var duration = $("#duration").val();

	var i=0;
	var fromLocations = [];
	$(".from-location").each(function() {
	    fromLocations[i++] = $(this).val();
	});

	var j = 0;
	var toLocations = [];
	$(".to-location").each(function() {
	    toLocations[j++] = $(this).val();
	});

	// console.log(reservationData);
	$.ajax({
        url  : baseUrl + "get-reservation",
        type : "POST",
        data : {first_name:first_name, last_name:last_name, mobile_no:mobile_no, email:email, pickup_address:pickup_address, duration:duration,
        		time:time, date:date, dropof_address:dropof_address, comment:comment, from_location:fromLocations, to_location:toLocations},
        success: function(response) {
        	$("#reservationOutput").html(response);
        	setTimeout(function() {
        		location.reload(true);
        	}, 2000);
        },
        error: function() {
            alert("There was might be some problem. Try again...");
        }
    });
}


// Add smooth scrolling to all links
$("#transferMenu").on('click', function(event) {
	// alert(this.hash);
    if (this.hash !== "") {
      	event.preventDefault();
      	var hash = this.hash;

      	// The optional number (800) specifies the number of milliseconds it takes to scroll to the specified area
      	$('html, body').animate({
        	scrollTop: $(hash).offset().top - 120
      	}, 1000, function(){
        	window.location.hash = hash;
      	});
    }

});

//  function initAutocomplete() {
//     // Create the autocomplete object, restricting the search predictions to
//     // geographical location types.
//     autocomplete = new google.maps.places.Autocomplete(
//         document.getElementById('from_location'), {types: ['geocode']});

//     autocomplete = new google.maps.places.Autocomplete(
//         document.getElementById('to_location'), {types: ['geocode']});
// }


function filterCars(filter)
{
	if (filter == '') {
	    $('#vehilcesList > .cars-main').fadeIn(450);
	} else {
		var $el = $('.' + filter).fadeIn(450);
	    $('#vehilcesList > .cars-main').not($el).hide();
	}
}

function sortCars(sort)
{
	var prices = [], i = 0;
	$(".priceList").each(function() {
		prices[i++] = $(this).val();
	});
	
	if (sort == 'up') {
	    prices.sort(function(a, b){return b - a});
	    orderIt(prices);
	} else {
		prices.sort(function(a, b){return a - b});
		orderIt(prices);
	}
}

function orderIt(prices)
{
	for(var i = 0; i < prices.length; i++) {
		var div = $("#"+prices[i]);
		$("#"+prices[i]).insertBefore('#prev-item');
	}
}